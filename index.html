<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora EV ¬∑ Energ√≠a de Carga</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }

:root {
  --bg:        #07090d;
  --s1:        rgba(255,255,255,0.035);
  --s2:        rgba(255,255,255,0.065);
  --border:    rgba(255,255,255,0.08);
  --green:     #00d296;
  --green-dim: rgba(0,210,150,0.12);
  --blue:      #3b9eff;
  --gold:      #f5c842;
  --text:      #dce8f2;
  --mid:       #7a8fa3;
  --muted:     #3e505f;
  --r:         14px;
  --rs:        10px;
}

html, body {
  background: var(--bg) !important;
  color: var(--text);
  font-family: 'Outfit', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
}

#bg { position:fixed; inset:0; z-index:0; pointer-events:none; }

.wrap {
  position: relative;
  z-index: 1;
  max-width: 560px;
  margin: 0 auto;
  padding: 1.5rem 1rem 5rem;
}

/* HEADER */
.hd {
  display: flex;
  align-items: center;
  gap: 0.9rem;
  margin-bottom: 1.25rem;
}
.hd-logo img {
  max-width: 80px; max-height: 40px;
  object-fit: contain;
  filter: brightness(1.1) drop-shadow(0 0 8px rgba(0,210,150,.35));
}
.hd-logo img.gone { display:none; }
.hd-text { flex:1; }
.hd-text h1 {
  font-family: 'Space Grotesk', sans-serif;
  font-size: clamp(1.05rem, 3.5vw, 1.35rem);
  font-weight: 700;
  letter-spacing: -0.02em;
  line-height: 1.2;
  background: linear-gradient(120deg, #e0eefa 40%, var(--green));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.hd-text p {
  font-size: 0.75rem;
  color: var(--mid);
  margin-top: 0.15rem;
  font-weight: 400;
}
.btn-how {
  flex-shrink: 0;
  background: rgba(59,158,255,0.08);
  border: 1px solid rgba(59,158,255,0.22);
  color: var(--blue);
  border-radius: 99px;
  padding: 0.4rem 0.85rem;
  font-family: 'Outfit', sans-serif;
  font-size: 0.7rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
}
.btn-how:hover { background: rgba(59,158,255,0.16); }

/* PANEL */
.panel {
  background: var(--s1);
  border: 1px solid var(--border);
  border-radius: var(--r);
  padding: 1.1rem;
  margin-bottom: 0.75rem;
  backdrop-filter: blur(16px);
  transition: border-color 0.25s;
}
.panel:hover { border-color: rgba(255,255,255,0.13); }

.plabel {
  font-size: 0.62rem;
  font-weight: 600;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: var(--muted);
  margin-bottom: 0.9rem;
  display: flex;
  align-items: center;
  gap: 0.4rem;
}
.plabel em {
  display: inline-block;
  width: 12px; height: 2px;
  background: var(--green);
  border-radius: 2px;
  font-style: normal;
}

/* BATTERY VISUAL */
.batt-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  background: rgba(0,0,0,0.22);
  border-radius: var(--rs);
  padding: 0.55rem 0.85rem;
  margin-bottom: 0.9rem;
}
.batt-icon {
  position: relative;
  width: 56px; height: 22px;
  border: 2px solid rgba(255,255,255,0.2);
  border-radius: 4px;
  flex-shrink: 0;
  overflow: visible;
}
.batt-icon::after {
  content:'';
  position: absolute;
  right: -5px; top: 50%;
  transform: translateY(-50%);
  width: 3px; height: 9px;
  background: rgba(255,255,255,0.2);
  border-radius: 0 2px 2px 0;
}
.batt-fill {
  position: absolute;
  top: 2px; bottom: 2px;
  border-radius: 2px;
  transition: width 0.3s ease, left 0.3s ease;
}
.batt-fill.actual { background: linear-gradient(90deg,#f5c842,#f59642); left:2px; }
.batt-fill.delta  { background: linear-gradient(90deg,var(--green),#00b4ff); opacity:.75; }

.batt-txt {
  font-family: 'Fira Code', monospace;
  font-size: 0.85rem;
  color: var(--mid);
  display: flex;
  align-items: center;
  gap: 0.3rem;
  flex-wrap: wrap;
}
.batt-txt b { color: var(--text); font-weight: 600; font-size: 1rem; }
.batt-txt .arrow-pct { color: var(--green); font-size: 0.78rem; }

/* SLIDER GRID */
.sl-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.9rem;
}
@media(max-width:400px){ .sl-grid { grid-template-columns:1fr; } }

.sg-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.45rem;
}
.sg-name { font-size: 0.78rem; font-weight: 500; color: var(--mid); }

.sg-inp-wrap {
  display: flex;
  align-items: center;
  gap: 0.2rem;
  background: var(--s2);
  border: 1px solid var(--border);
  border-radius: 7px;
  padding: 0.12rem 0.42rem;
  transition: border-color 0.2s;
}
.sg-inp-wrap:focus-within { border-color: var(--green); }
.sg-inp {
  width: 34px;
  background: transparent; border: none;
  color: var(--text);
  font-family: 'Fira Code', monospace;
  font-size: 0.85rem; font-weight: 500;
  text-align: right; outline: none;
}
.sg-sym { color: var(--muted); font-size: 0.72rem; }

input[type=range] {
  -webkit-appearance: none; appearance: none;
  width: 100%; height: 5px;
  border-radius: 99px;
  background: rgba(255,255,255,0.07);
  outline: none; cursor: pointer;
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none; appearance: none;
  width: 17px; height: 17px;
  border-radius: 50%; cursor: pointer;
  transition: transform 0.15s, box-shadow 0.2s;
}
input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.18); }
#actual-slider::-webkit-slider-thumb { background:#f5c842; box-shadow:0 0 0 3px rgba(245,200,66,.18); }
#final-slider::-webkit-slider-thumb  { background:var(--green); box-shadow:0 0 0 3px rgba(0,210,150,.18); }

.quick-row {
  display: flex; gap: 0.3rem;
  margin-top: 0.5rem;
}
.qb {
  padding: 0.2rem 0.55rem;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: transparent;
  color: var(--mid);
  font-family: 'Outfit', sans-serif;
  font-size: 0.68rem; font-weight: 600;
  cursor: pointer; transition: all 0.18s;
}
.qb:hover { border-color: var(--green); color: var(--green); background: var(--green-dim); }

/* RESULT PANEL */
.result-panel {
  background: linear-gradient(140deg, rgba(0,210,150,0.08), rgba(59,158,255,0.04));
  border: 1px solid rgba(0,210,150,0.2);
  border-radius: var(--r);
  padding: 1.25rem 1.1rem;
  margin-bottom: 0.75rem;
  position: relative;
  overflow: hidden;
  animation: gpulse 3.5s ease-in-out infinite;
}
.result-panel::before {
  content:'';
  position:absolute; top:-50px; left:50%;
  transform:translateX(-50%);
  width:160px; height:160px;
  background:radial-gradient(circle,rgba(0,210,150,.1) 0%,transparent 70%);
  pointer-events:none;
}
@keyframes gpulse {
  0%,100%{ box-shadow:none; }
  50%    { box-shadow:0 0 26px rgba(0,210,150,.13); }
}

.res-cols {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  align-items: center;
}
.res-divider { width:1px; height:55px; background:var(--border); margin:0 0.9rem; }

.rb { text-align:center; }
.rb-lbl {
  font-size: 0.58rem;
  font-weight: 700;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  margin-bottom: 0.3rem;
}
.rb-lbl.g { color:var(--green); }
.rb-lbl.go{ color:var(--gold); }

.rb-num {
  font-family: 'Space Grotesk', sans-serif;
  font-weight: 700;
  letter-spacing: -0.03em;
  line-height: 1;
  transition: all 0.3s cubic-bezier(.34,1.56,.64,1);
}
.rb-num.kwh {
  font-size: clamp(2rem, 7vw, 3.2rem);
  background: linear-gradient(135deg,#fff 30%,var(--green));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.rb-num.price {
  font-size: clamp(1.3rem, 4.5vw, 2rem);
  background: linear-gradient(135deg,#fce97a,var(--gold));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.rb-num.price small {
  font-size: 0.33em; font-weight:600; letter-spacing:.13em;
  font-family:'Fira Code',monospace;
  -webkit-text-fill-color:rgba(200,154,32,.5);
  color:rgba(200,154,32,.5);
  vertical-align:middle; margin-left:.12em; background:none;
}
.rb-sub { font-size:0.62rem; color:var(--muted); margin-top:0.25rem; letter-spacing:0.04em; }
.rb-sub.gold-sub { font-size:0.56rem; color:rgba(200,154,32,.45); letter-spacing:0.05em; }

.res-meta {
  display: flex;
  justify-content: space-around;
  margin-top: 0.9rem;
  padding-top: 0.8rem;
  border-top: 1px solid var(--border);
  flex-wrap: wrap; gap: 0.4rem;
}
.rm { text-align:center; }
.rm-v { font-family:'Fira Code',monospace; font-size:0.95rem; font-weight:500; color:var(--blue); }
.rm-l { font-size:0.56rem; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); margin-top:.1rem; }

/* PARAMS */
.params-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 0.7rem;
}
@media(max-width:380px){ .params-grid { grid-template-columns:1fr; } }

.pf-lbl { font-size:0.62rem; letter-spacing:.1em; text-transform:uppercase; color:var(--muted); margin-bottom:.3rem; font-weight:500; }
.pf-wrap {
  display:flex; align-items:center; gap:.4rem;
  background:var(--s2); border:1px solid var(--border);
  border-radius:var(--rs); padding:.5rem .7rem;
  transition:border-color .2s;
}
.pf-wrap:focus-within { border-color:var(--green); }
.pf-inp { background:transparent; border:none; color:var(--text); font-family:'Fira Code',monospace; font-size:.92rem; font-weight:500; width:100%; outline:none; }
.pf-unit { font-family:'Fira Code',monospace; font-size:.6rem; color:var(--muted); white-space:nowrap; }

/* CONDITIONS */
.cond-grid {
  display: grid;
  grid-template-columns: repeat(4,1fr);
  gap: 0.5rem;
}
@media(max-width:360px){ .cond-grid { grid-template-columns:repeat(2,1fr); } }

.cb {
  background:transparent; border:1px solid var(--border);
  border-radius:var(--rs); padding:.55rem .25rem;
  cursor:pointer; text-align:center; transition:all .2s;
  font-family:'Outfit',sans-serif;
}
.cb .ci { font-size:1.15rem; display:block; margin-bottom:.18rem; }
.cb .cn { font-size:.65rem; font-weight:600; color:var(--mid); display:block; }
.cb .cm { font-size:.56rem; color:var(--muted); font-family:'Fira Code',monospace; display:block; margin-top:.08rem; }
.cb.on  { border-color:var(--green); background:var(--green-dim); }
.cb.on .cn { color:var(--green); }
.cb.on .cm { color:rgba(0,210,150,.55); }

/* AUTONOMY */
.auto-row {
  display:flex; justify-content:space-around;
  background:rgba(0,0,0,.2); border-radius:var(--rs);
  padding:.65rem .4rem; margin-top:.8rem;
  flex-wrap:wrap; gap:.4rem;
}
.ar { text-align:center; }
.ar-v { font-family:'Fira Code',monospace; font-size:.92rem; font-weight:500; color:var(--blue); }
.ar-l { font-size:.56rem; letter-spacing:.09em; text-transform:uppercase; color:var(--muted); margin-top:.08rem; }

/* BOTTOM */
.bottom-row {
  display:flex; justify-content:flex-end; margin-top:.3rem;
}
.btn-reset {
  background:var(--s2); border:1px solid var(--border);
  border-radius:99px; color:var(--mid);
  font-family:'Outfit',sans-serif; font-size:.72rem; font-weight:600;
  padding:.4rem .95rem; cursor:pointer; transition:all .2s;
}
.btn-reset:hover { border-color:rgba(255,255,255,.2); color:var(--text); }

/* FOOTER */
footer {
  text-align:center; padding:1.4rem 0 .5rem;
  border-top:1px solid var(--border); margin-top:1.5rem;
}
.ft-n { font-size:.7rem; font-weight:600; letter-spacing:.1em; text-transform:uppercase; color:var(--mid); }
.ft-n span { color:var(--green); }
.ft-c { font-family:'Fira Code',monospace; font-size:.65rem; color:var(--muted); margin-top:.22rem; }

/* MODAL */
.overlay {
  position:fixed; inset:0; background:rgba(0,0,0,.72);
  backdrop-filter:blur(10px); z-index:200;
  display:flex; align-items:center; justify-content:center;
  padding:1.5rem; opacity:0; pointer-events:none; transition:opacity .3s;
}
.overlay.open { opacity:1; pointer-events:all; }
.modal {
  background:#0c1118; border:1px solid rgba(0,210,150,.18);
  border-radius:18px; max-width:500px; width:100%;
  max-height:82vh; overflow-y:auto;
  padding:1.6rem;
  box-shadow:0 30px 80px rgba(0,0,0,.7);
  transform:translateY(16px) scale(.97);
  transition:transform .3s cubic-bezier(.34,1.56,.64,1);
  scrollbar-width:thin; scrollbar-color:var(--muted) transparent;
}
.overlay.open .modal { transform:translateY(0) scale(1); }
.m-hd { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.1rem; }
.m-title { font-family:'Space Grotesk',sans-serif; font-size:1.05rem; font-weight:700;
  background:linear-gradient(120deg,#fff,var(--green)); -webkit-background-clip:text;
  -webkit-text-fill-color:transparent; background-clip:text; }
.m-x { background:var(--s2); border:1px solid var(--border); color:var(--muted);
  width:28px; height:28px; border-radius:7px; cursor:pointer; font-size:.85rem;
  display:flex; align-items:center; justify-content:center; transition:all .2s; }
.m-x:hover { color:var(--text); }
.m-sec { margin-bottom:1rem; padding-bottom:1rem; border-bottom:1px solid var(--border); }
.m-sec:last-child { border-bottom:none; margin-bottom:0; padding-bottom:0; }
.m-st { font-size:.6rem; letter-spacing:.13em; text-transform:uppercase; color:var(--green); font-family:'Fira Code',monospace; margin-bottom:.45rem; }
.m-sec p { font-size:.8rem; color:var(--mid); line-height:1.65; }
.fbox { background:rgba(0,210,150,.06); border:1px solid rgba(0,210,150,.18); border-radius:9px; padding:.65rem .85rem; font-family:'Fira Code',monospace; font-size:.75rem; color:var(--green); letter-spacing:.03em; margin:.45rem 0; line-height:1.6; }
.wbox { background:rgba(245,200,66,.06); border:1px solid rgba(245,200,66,.18); border-radius:9px; padding:.65rem .85rem; font-size:.76rem; color:#c4991a; line-height:1.6; }
.wlist { list-style:none; columns:2; gap:.4rem; margin-top:.35rem; font-size:.72rem; color:#9a7a10; }
.wlist li::before { content:'¬∑ '; color:var(--gold); }

/* ANIMATIONS */
@keyframes fadeUp { from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:translateY(0)} }
.hd           { animation:fadeUp .38s ease .04s both; }
.result-panel { animation:fadeUp .38s ease .08s both; }
.panel        { animation:fadeUp .38s ease .12s both; }
.panel:nth-of-type(2){ animation-delay:.16s; }
.panel:nth-of-type(3){ animation-delay:.20s; }
</style>
</head>
<body>

<canvas id="bg"></canvas>

<div class="wrap">

  <!-- HEADER -->
  <div class="hd">
    <div class="hd-logo">
      <img src="logo_byd.png" alt="BYD" onerror="this.classList.add('gone')">
    </div>
    <div class="hd-text">
      <h1>Calculadora EV ¬∑ Energ√≠a de Carga</h1>
      <p>¬øCu√°nto pagas en la estaci√≥n hoy?</p>
    </div>
    <button class="btn-how" onclick="openModal()">‚ùì ¬øC√≥mo funciona?</button>
  </div>

  <!-- ‚ë† SLIDERS -->
  <div class="panel">
    <div class="plabel"><em></em> Nivel de bater√≠a</div>

    <!-- Visual battery bar -->
    <div class="batt-row">
      <div class="batt-icon">
        <div class="batt-fill actual" id="batt-a" style="width:20%"></div>
        <div class="batt-fill delta"  id="batt-d" style="width:60%; left:calc(2px + 20%)"></div>
      </div>
      <div class="batt-txt">
        <b id="bv-a">20</b><span>%</span>
        &nbsp;‚Üí&nbsp;
        <b id="bv-f">80</b><span>%</span>
        &nbsp;
        <span class="arrow-pct" id="bv-diff">(+60%)</span>
      </div>
    </div>

    <div class="sl-grid">
      <!-- Actual -->
      <div>
        <div class="sg-top">
          <span class="sg-name">üîã Bater√≠a actual</span>
          <div class="sg-inp-wrap">
            <input class="sg-inp" type="number" id="actual-input" min="0" max="99" value="20">
            <span class="sg-sym">%</span>
          </div>
        </div>
        <input type="range" id="actual-slider" min="0" max="99" value="20" step="1">
      </div>

      <!-- Final -->
      <div>
        <div class="sg-top">
          <span class="sg-name">üéØ Objetivo</span>
          <div class="sg-inp-wrap">
            <input class="sg-inp" type="number" id="final-input" min="1" max="100" value="80">
            <span class="sg-sym">%</span>
          </div>
        </div>
        <input type="range" id="final-slider" min="1" max="100" value="80" step="1">
        <div class="quick-row">
          <button class="qb" onclick="setFinal(80)">80%</button>
          <button class="qb" onclick="setFinal(90)">90%</button>
          <button class="qb" onclick="setFinal(100)">100%</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ë° RESULTADO -->
  <div class="result-panel">
    <div class="res-cols">
      <div class="rb">
        <div class="rb-lbl g">‚ö° Debes cargar</div>
        <div class="rb-num kwh" id="result-kwh">0.0</div>
        <div class="rb-sub">kWh</div>
      </div>
      <div class="res-divider"></div>
      <div class="rb">
        <div class="rb-lbl go">üí≥ Costo estimado</div>
        <div class="rb-num price" id="result-price">$ 0 <small>COP</small></div>
        <div class="rb-sub gold-sub">Terpel ¬∑ Feb 2026 ¬∑ $1.650/kWh</div>
      </div>
    </div>
    <div class="res-meta">
      <div class="rm"><div class="rm-v" id="pct-diff">+0%</div><div class="rm-l">Incremento</div></div>
      <div class="rm"><div class="rm-v" id="pct-cap">‚Äî</div><div class="rm-l">% cap. total</div></div>
      <div class="rm"><div class="rm-v" id="range-gained">‚Äî km</div><div class="rm-l">Autonom√≠a ganada</div></div>
    </div>
  </div>

  <!-- ‚ë¢ PAR√ÅMETROS -->
  <div class="panel">
    <div class="plabel"><em></em> Par√°metros del veh√≠culo</div>
    <div class="params-grid">
      <div>
        <div class="pf-lbl">Capacidad bater√≠a</div>
        <div class="pf-wrap">
          <input class="pf-inp" type="number" id="capacity-input" value="45.12" step="0.01" min="1">
          <span class="pf-unit">kWh</span>
        </div>
      </div>
      <div>
        <div class="pf-lbl">Consumo referencia</div>
        <div class="pf-wrap">
          <input class="pf-inp" type="number" id="consumption-input" value="12.2" step="0.1" min="1">
          <span class="pf-unit">kWh / 100 km</span>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ë£ CONDICIONES -->
  <div class="panel">
    <div class="plabel"><em></em> Condiciones de conducci√≥n</div>
    <div class="cond-grid">
      <button class="cb on" onclick="setCond(this,1.0)">
        <span class="ci">üîÑ</span><span class="cn">Est√°ndar</span><span class="cm">√ó1.00</span>
      </button>
      <button class="cb" onclick="setCond(this,0.88)">
        <span class="ci">üèôÔ∏è</span><span class="cn">Urbano</span><span class="cm">√ó0.88</span>
      </button>
      <button class="cb" onclick="setCond(this,1.18)">
        <span class="ci">üõ£Ô∏è</span><span class="cn">Autopista</span><span class="cm">√ó1.18</span>
      </button>
      <button class="cb" onclick="setCond(this,1.35)">
        <span class="ci">‚õ∞Ô∏è</span><span class="cn">Exigente</span><span class="cm">√ó1.35</span>
      </button>
    </div>
    <div class="auto-row">
      <div class="ar"><div class="ar-v" id="range-total">‚Äî km</div><div class="ar-l">Autonom√≠a total</div></div>
      <div class="ar"><div class="ar-v" id="range-current">‚Äî km</div><div class="ar-l">Con bater√≠a actual</div></div>
      <div class="ar"><div class="ar-v" id="range-after">‚Äî km</div><div class="ar-l">Tras la carga</div></div>
    </div>
    <p style="font-size:.58rem;color:var(--muted);margin-top:.55rem;font-family:'Fira Code',monospace;">* Condiciones solo afectan autonom√≠a, no los kWh a cargar.</p>
  </div>

  <div class="bottom-row">
    <button class="btn-reset" onclick="resetAll()">‚Ü© Restablecer</button>
  </div>

</div>

<footer>
  <div class="ft-n">Web creada por <span>Esteban G ‚Äî Kokito Star</span></div>
  <div class="ft-c">Contacto: 3218526763</div>
</footer>

<!-- MODAL -->
<div class="overlay" id="overlay" onclick="closeOut(event)">
  <div class="modal">
    <div class="m-hd">
      <div class="m-title">üìä ¬øC√≥mo se calcula?</div>
      <button class="m-x" onclick="closeModal()">‚úï</button>
    </div>
    <div class="m-sec">
      <div class="m-st">1. F√≥rmula principal</div>
      <div class="fbox">kWh = Capacidad_bater√≠a √ó (Final% ‚àí Actual%) √∑ 100</div>
      <p>Calcula la energ√≠a necesaria para subir el nivel de carga de la bater√≠a.</p>
    </div>
    <div class="m-sec">
      <div class="m-st">2. Consumo vs carga</div>
      <p>El consumo del veh√≠culo <strong style="color:var(--text)">NO modifica los kWh a cargar</strong>. Solo determina cu√°ntos km recorrer√°s con esa energ√≠a.</p>
    </div>
    <div class="m-sec">
      <div class="m-st">3. F√≥rmula de autonom√≠a</div>
      <div class="fbox">Autonom√≠a = Capacidad √∑ Consumo (kWh/km)<br>Ej: 12.2 kWh/100km = 0.122 kWh/km</div>
    </div>
    <div class="m-sec">
      <div class="m-st">4. Precio estimado</div>
      <p>Basado en la tarifa de <strong style="color:var(--gold)">$1.650 COP por kWh</strong> de la app Terpel, febrero 2026. Puede variar seg√∫n cargador y ciudad.</p>
    </div>
    <div class="m-sec">
      <div class="m-st">5. Advertencia t√©cnica</div>
      <div class="wbox">Resultados estimados. Los valores reales var√≠an seg√∫n:
        <ul class="wlist">
          <li>Velocidad</li><li>Topograf√≠a</li>
          <li>Temperatura</li><li>Llantas</li>
          <li>Aire acondicionado</li><li>Peso</li>
          <li>Estado bater√≠a</li><li>Carga extra</li>
        </ul>
      </div>
    </div>
    <div class="m-sec">
      <div class="m-st">6. Supuesto</div>
      <p>Se asume bater√≠a en condiciones normales, sin degradaci√≥n significativa.</p>
    </div>
  </div>
</div>

<script>
/* ‚îÄ‚îÄ CANVAS ‚îÄ‚îÄ */
(function(){
  const c=document.getElementById('bg'), x=c.getContext('2d');
  let W,H,mouse={x:-9999,y:-9999},pts=[];
  const N=48,D=150;
  function resize(){ W=c.width=innerWidth; H=c.height=innerHeight; }
  function init(){ pts=[]; for(let i=0;i<N;i++) pts.push({x:Math.random()*W,y:Math.random()*H,vx:(Math.random()-.5)*.3,vy:(Math.random()-.5)*.3}); }
  function draw(){
    x.clearRect(0,0,W,H);
    pts.forEach(p=>{ const ex=(mouse.x-W/2)*.006,ey=(mouse.y-H/2)*.006; p.x+=p.vx+ex*.018; p.y+=p.vy+ey*.018; if(p.x<0)p.x=W; if(p.x>W)p.x=0; if(p.y<0)p.y=H; if(p.y>H)p.y=0; });
    for(let i=0;i<pts.length;i++) for(let j=i+1;j<pts.length;j++){ const a=pts[i],b=pts[j],dx=a.x-b.x,dy=a.y-b.y,d=Math.sqrt(dx*dx+dy*dy); if(d<D){ x.beginPath(); x.strokeStyle=`rgba(0,210,150,${(1-d/D)*.14})`; x.lineWidth=.7; x.moveTo(a.x,a.y); x.lineTo(b.x,b.y); x.stroke(); } }
    pts.forEach(p=>{ x.beginPath(); x.arc(p.x,p.y,1.4,0,Math.PI*2); x.fillStyle='rgba(0,210,150,.28)'; x.fill(); });
    requestAnimationFrame(draw);
  }
  window.addEventListener('resize',()=>{resize();init();});
  window.addEventListener('mousemove',e=>{mouse.x=e.clientX;mouse.y=e.clientY;});
  window.addEventListener('touchmove',e=>{if(e.touches[0]){mouse.x=e.touches[0].clientX;mouse.y=e.touches[0].clientY;}},{passive:true});
  resize(); init(); draw();
})();

/* ‚îÄ‚îÄ APP ‚îÄ‚îÄ */
const aSlider=document.getElementById('actual-slider');
const fSlider=document.getElementById('final-slider');
const aInput =document.getElementById('actual-input');
const fInput =document.getElementById('final-input');
const capInp =document.getElementById('capacity-input');
const consInp=document.getElementById('consumption-input');
let condMult=1.0;

function fillSlider(sl,color){
  const pct=((+sl.value - +sl.min)/(+sl.max - +sl.min))*100;
  sl.style.background=`linear-gradient(to right,${color} ${pct}%,rgba(255,255,255,.07) ${pct}%)`;
}

function updateBatt(actual,final){
  document.getElementById('batt-a').style.width = actual+'%';
  const dW=Math.max(0,final-actual);
  document.getElementById('batt-d').style.cssText=`width:${dW}%; left:calc(2px + ${actual}%);`;
  document.getElementById('bv-a').textContent=actual;
  document.getElementById('bv-f').textContent=final;
  document.getElementById('bv-diff').textContent=`(+${final-actual}%)`;
}

function calc(){
  const actual=Math.max(0,Math.min(99,+aInput.value||0));
  const final_=Math.max(1,Math.min(100,+fInput.value||100));
  const safe  =Math.max(final_,actual+1);
  const cap   =Math.max(.1,+capInp.value||45.12);
  const cons  =Math.max(.1,+consInp.value||12.2);

  /* F√ìRMULA PRINCIPAL ‚Äî no cambia con condiciones */
  const kWh   =cap*(safe-actual)/100;
  const pctDif=safe-actual;
  const pctCap=(kWh/cap*100).toFixed(1);

  /* PRECIO ‚Äî Terpel Feb 2026: $1.650 COP/kWh */
  const price=Math.round(kWh*1650);

  /* AUTONOM√çA ‚Äî s√≠ cambia con condiciones */
  const ckm  =(cons/100)*condMult;
  const rTot =Math.round(cap/ckm);
  const rCur =Math.round(cap*actual/100/ckm);
  const rGain=Math.round(kWh/ckm);
  const rAft =Math.round(cap*safe/100/ckm);

  document.getElementById('result-kwh').textContent   = kWh.toFixed(2);
  document.getElementById('result-price').innerHTML   = '$ '+price.toLocaleString('es-CO')+' <small>COP</small>';
  document.getElementById('pct-diff').textContent     = `+${pctDif}%`;
  document.getElementById('pct-cap').textContent      = `${pctCap}%`;
  document.getElementById('range-gained').textContent = `+${rGain} km`;
  document.getElementById('range-total').textContent  = `${rTot} km`;
  document.getElementById('range-current').textContent= `${rCur} km`;
  document.getElementById('range-after').textContent  = `${rAft} km`;

  fillSlider(aSlider,'#f5c842');
  fillSlider(fSlider,'#00d296');
  updateBatt(actual,safe);
}

aSlider.addEventListener('input',()=>{ aInput.value=aSlider.value; if(+fInput.value<=+aSlider.value){fInput.value=+aSlider.value+1;fSlider.value=fInput.value;} calc(); });
fSlider.addEventListener('input',()=>{ fInput.value=fSlider.value; if(+aInput.value>=+fSlider.value){aInput.value=+fSlider.value-1;aSlider.value=aInput.value;} calc(); });
aInput.addEventListener('input',()=>{ aInput.value=Math.max(0,Math.min(99,+aInput.value||0)); aSlider.value=aInput.value; calc(); });
fInput.addEventListener('input',()=>{ fInput.value=Math.max(1,Math.min(100,+fInput.value||100)); fSlider.value=fInput.value; calc(); });
capInp.addEventListener('input',calc);
consInp.addEventListener('input',calc);

function setFinal(v){ fInput.value=v; fSlider.value=v; if(+aInput.value>=v){aInput.value=v-1;aSlider.value=v-1;} calc(); }
function setCond(btn,m){ document.querySelectorAll('.cb').forEach(b=>b.classList.remove('on')); btn.classList.add('on'); condMult=m; calc(); }
function resetAll(){ aInput.value=20;aSlider.value=20; fInput.value=80;fSlider.value=80; capInp.value=45.12;consInp.value=12.2; condMult=1.0; document.querySelectorAll('.cb').forEach((b,i)=>b.classList.toggle('on',i===0)); calc(); }

function openModal(){ document.getElementById('overlay').classList.add('open'); document.body.style.overflow='hidden'; }
function closeModal(){ document.getElementById('overlay').classList.remove('open'); document.body.style.overflow=''; }
function closeOut(e){ if(e.target===document.getElementById('overlay')) closeModal(); }
document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeModal(); });

calc();
</script>
</body>
</html>
